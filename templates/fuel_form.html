{% extends "base.html" %}
{% block title %}Log Fuel — {{ club.name if club else 'FleetNests' }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-12 col-md-7 col-lg-5">
    <div class="d-flex align-items-center mb-4">
      <a href="{{ url_for('my_reservations') }}" class="btn btn-sm btn-outline-secondary me-3">
        <i class="bi bi-arrow-left"></i>
      </a>
      <h5 class="mb-0 fw-bold">
        <i class="bi bi-fuel-pump me-2 text-danger"></i>Log Fuel Purchase
        <a href="{{ url_for('help_page') }}#fuel-log" class="text-muted ms-1"
           data-bs-toggle="tooltip" title="Help: How and when to log fuel purchases">
          <i class="bi bi-question-circle-fill" style="font-size:0.8rem"></i>
        </a>
      </h5>
    </div>

    <div class="card border-0 shadow-sm">
      <div class="card-body p-4">
        <form method="post" id="fuelForm">
          <input type="hidden" name="res_id" value="{{ res.id if res else '' }}">

          <div class="mb-3">
            <label class="form-label">Date</label>
            <input type="date" class="form-control" name="log_date"
                   value="{{ res.date.isoformat() if res else today }}" required>
          </div>

          {% if res %}
          <div class="mb-3">
            <label class="form-label text-muted small">Linked Reservation</label>
            <div class="form-control-plaintext text-muted small">
              {{ res.date.strftime('%B %d, %Y') }}
              {{ res.start_time.strftime('%-I:%M %p') }}–{{ res.end_time.strftime('%-I:%M %p') }} CT
            </div>
          </div>
          {% endif %}

          <div class="row g-3 mb-3">
            <div class="col-12">
              <label class="form-label">Gallons <span class="text-danger">*</span></label>
              <input type="number" class="form-control" name="gallons" id="gallons"
                     min="0.1" step="0.01" required placeholder="e.g. 12.5">
            </div>
            <div class="col-6">
              <label class="form-label">Price / Gallon <small class="text-muted">(optional)</small></label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" class="form-control" name="price_per_gallon" id="price"
                       min="0" step="0.001" placeholder="3.499">
              </div>
            </div>
            <div class="col-6">
              <label class="form-label">Total Cost <small class="text-muted">(auto-calc)</small></label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" class="form-control" name="total_cost" id="total"
                       min="0" step="0.01" placeholder="auto">
              </div>
            </div>
          </div>

          <div class="mb-4">
            <label class="form-label">Notes <small class="text-muted">(optional)</small></label>
            <input type="text" class="form-control" name="notes" maxlength="300"
                   placeholder="Station name, receipt #, etc.">
          </div>

          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-danger">
              <i class="bi bi-save me-1"></i>Save Entry
            </button>
            <a href="{{ url_for('my_reservations') }}" class="btn btn-outline-secondary">Cancel</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Auto-calculate total cost when gallons or price changes
const gallons = document.getElementById('gallons');
const price   = document.getElementById('price');
const total   = document.getElementById('total');

function calcTotal() {
  const g = parseFloat(gallons.value);
  const p = parseFloat(price.value);
  if (!isNaN(g) && !isNaN(p) && g > 0 && p > 0) {
    total.value = (g * p).toFixed(2);
  }
}
gallons.addEventListener('input', calcTotal);
price.addEventListener('input', calcTotal);
</script>
{% endblock %}
