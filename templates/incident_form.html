{% extends "base.html" %}
{% block title %}Report Incident — FleetNests{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-12 col-md-7 col-lg-6">
    <div class="d-flex align-items-center mb-4">
      <a href="{{ url_for('my_reservations') }}" class="btn btn-sm btn-outline-secondary me-3">
        <i class="bi bi-arrow-left"></i>
      </a>
      <h5 class="mb-0 fw-bold">
        <i class="bi bi-exclamation-triangle me-2 text-warning"></i>Report an Incident
        <a href="{{ url_for('help_page') }}#incidents" class="text-muted ms-1"
           data-bs-toggle="tooltip" title="Help: Severity levels and what to include in your report">
          <i class="bi bi-question-circle-fill" style="font-size:0.8rem"></i>
        </a>
      </h5>
    </div>

    <div class="card border-0 shadow-sm">
      <div class="card-body p-4">
        <form method="post">
          <input type="hidden" name="res_id" value="{{ res.id if res else '' }}">

          <div class="mb-3">
            <label class="form-label">Date of Incident</label>
            <input type="date" class="form-control" name="report_date"
                   value="{{ res.date.isoformat() if res else today }}" required>
          </div>

          <div class="mb-3">
            <label class="form-label">
              Severity
              <a href="{{ url_for('help_page') }}#incidents" class="text-muted ms-1"
                 data-bs-toggle="tooltip" title="Minor = cosmetic · Moderate = affects operation · Major = safety concern">
                <i class="bi bi-question-circle-fill" style="font-size:0.8rem"></i>
              </a>
            </label>
            <select class="form-select" name="severity">
              <option value="minor">Minor — cosmetic damage or minor issue</option>
              <option value="moderate">Moderate — affects boat operation</option>
              <option value="major">Major — significant damage or safety concern</option>
            </select>
          </div>

          {% if res %}
          <div class="mb-3">
            <label class="form-label text-muted small">Linked Reservation</label>
            <div class="form-control-plaintext text-muted small">
              {{ res.date.strftime('%B %d, %Y') }}
              {{ res.start_time.strftime('%-I:%M %p') }}–{{ res.end_time.strftime('%-I:%M %p') }} CT
            </div>
          </div>
          {% endif %}

          <div class="mb-4">
            <label class="form-label">Description <span class="text-danger">*</span></label>
            <textarea class="form-control" name="description" rows="5" required
                      placeholder="Describe what happened, what was damaged, and any relevant details..."></textarea>
          </div>

          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-warning">
              <i class="bi bi-send me-1"></i>Submit Report
            </button>
            <a href="{{ url_for('my_reservations') }}" class="btn btn-outline-secondary">Cancel</a>
          </div>
        </form>
      </div>
    </div>

    <div class="alert alert-info mt-3 small">
      <i class="bi bi-info-circle me-1"></i>
      Incident reports are reviewed by club administrators. For urgent safety issues, contact the club directly.
    </div>
  </div>
</div>
{% endblock %}
