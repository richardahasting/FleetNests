{% extends "base.html" %}
{% block title %}Help — FleetNests{% endblock %}

{% block content %}
<div class="row">

  {# ---- Sidebar TOC (desktop) ---- #}
  <div class="col-md-3 d-none d-md-block">
    <div class="sticky-top" style="top:1.5rem">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-club-blue text-white fw-semibold">
          <i class="bi bi-journal-text me-2"></i>Help Contents
        </div>
        <div class="list-group list-group-flush small">
          <a class="list-group-item list-group-item-action py-2" href="#member-guide">
            <i class="bi bi-person me-1 text-club-blue"></i><strong>Member Guide</strong>
          </a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#getting-started">Getting Started</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#calendar">The Calendar</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#making-reservation">Making a Reservation</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#my-trips">My Trips</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#checkout">Check-Out</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#checkin">Check-In</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#captains-checklist">Captain's Checklist</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#weather-alerts">Weather Alerts</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#waitlist">Waitlist</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#messages">Message Board</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#profile">Your Profile</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#family-login">Family Login</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#fuel-log">Fuel Log</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#incidents">Incident Reports</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#feedback">Feedback</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#ical">Calendar Subscription</a>
          {% if current_user.is_admin %}
          <a class="list-group-item list-group-item-action py-2" href="#admin-guide">
            <i class="bi bi-shield-check me-1 text-club-blue"></i><strong>Admin Guide</strong>
          </a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#admin-members">Managing Members</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#admin-family">Family Accounts</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#admin-blackouts">Blackout Dates</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#admin-approvals">Approvals</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#admin-incidents">Incidents</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#admin-fuel">Fuel Statistics</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#admin-trip-logs">Trip Logs</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#admin-feedback">Feedback</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#admin-audit">Audit Log</a>
          <a class="list-group-item list-group-item-action py-2 ps-4" href="#admin-export">Export CSV</a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  {# ---- Main content ---- #}
  <div class="col-12 col-md-9">

    <div class="d-flex align-items-center mb-4">
      <a href="{{ url_for('calendar') }}" class="btn btn-sm btn-outline-secondary me-3">
        <i class="bi bi-arrow-left"></i>
      </a>
      <div>
        <h4 class="mb-0 fw-bold">
          <i class="bi bi-question-circle me-2 text-club-blue"></i>Help &amp; Documentation
        </h4>
        <div class="text-muted small">FleetNests Reservation System</div>
      </div>
    </div>

    {# ================================================================
       MEMBER GUIDE
       ================================================================ #}
    <h5 class="text-uppercase text-muted fw-semibold small mb-3 mt-2" id="member-guide">
      <i class="bi bi-person me-1"></i>Member Guide
    </h5>

    {# --- Getting Started --- #}
    <div class="card border-0 shadow-sm mb-4" id="getting-started">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-door-open me-2 text-club-blue"></i>Getting Started
      </div>
      <div class="card-body p-4">
        <p>Welcome to the <strong>FleetNests</strong> reservation system. This web app lets you book the club boat, log trips, report issues, and stay in touch with other members.</p>

        <h6 class="fw-semibold mt-3">Logging In</h6>
        <p class="mb-2">Sign in with your <strong>username</strong> or <strong>email address</strong> and your password. If you're a family sub-member, log in with your own email and password (set by the primary account holder).</p>

        <h6 class="fw-semibold mt-3">Forgot Your Password?</h6>
        <p>Click <strong>Forgot your password?</strong> on the login page, enter your username or email, and a reset link will be emailed to you. The link expires in 72 hours. If you don't receive an email, check your spam folder or contact a club administrator.</p>

        <h6 class="fw-semibold mt-3">New Member Welcome Email</h6>
        <p>When an admin creates your account without setting a password, you'll receive a welcome email with a link to set your own password. The link expires in 72 hours — if it has expired, contact your administrator to resend it.</p>

        <h6 class="fw-semibold mt-3">Navigation</h6>
        <p class="mb-1">The top navigation bar gives you access to everything:</p>
        <ul class="mb-0">
          <li><i class="bi bi-calendar3 me-1 text-club-blue"></i><strong>Calendar</strong> — View availability and book the boat</li>
          <li><i class="bi bi-bookmark-star me-1 text-club-blue"></i><strong>My Trips</strong> — Manage your reservations and log trips</li>
          <li><i class="bi bi-bar-chart me-1 text-club-blue"></i><strong>Stats</strong> — See usage statistics for all members</li>
          <li><i class="bi bi-chat-square-text me-1 text-club-blue"></i><strong>Messages</strong> — Club announcements and member posts</li>
          <li><i class="bi bi-journal-bookmark me-1 text-club-blue"></i><strong>Rules</strong> — Club rules and the Captain's Checklist</li>
          <li><i class="bi bi-person-circle me-1 text-club-blue"></i><strong>Your Name</strong> — Access your profile settings and log out</li>
        </ul>
      </div>
    </div>

    {# --- The Calendar --- #}
    <div class="card border-0 shadow-sm mb-4" id="calendar">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-calendar3 me-2 text-club-blue"></i>The Reservation Calendar
      </div>
      <div class="card-body p-4">
        <p>The calendar shows all reservations for the club boat at a glance. Switch between <strong>month view</strong> and <strong>list view</strong> using the buttons in the calendar header.</p>

        <h6 class="fw-semibold mt-3">Reading the Calendar</h6>
        <ul>
          <li><span class="badge bg-club-blue">&#9679;</span> <strong>Navy events</strong> — Your own reservations (or your family account's)</li>
          <li><span class="badge bg-secondary">&#9679;</span> <strong>Gray events</strong> — Reservations by other members</li>
          <li><span class="badge bg-warning text-dark">&#9679;</span> <strong>Yellow events</strong> — Reservations pending admin approval</li>
          <li><span class="badge bg-danger">&#9679;</span> <strong>Red events</strong> — Blackout dates (boat unavailable)</li>
        </ul>
        <p>Events show the <strong>member name</strong> (e.g. "The Hasting family") rather than an individual login name.</p>

        <h6 class="fw-semibold mt-3">Booking from the Calendar</h6>
        <p class="mb-0">Click any <strong>future date</strong> to open the booking page for that day. You can see who has already reserved the boat, check the current weather forecast, and make your own reservation.</p>
      </div>
    </div>

    {# --- Making a Reservation --- #}
    <div class="card border-0 shadow-sm mb-4" id="making-reservation">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-plus-circle me-2 text-club-blue"></i>Making a Reservation
      </div>
      <div class="card-body p-4">
        <p>Click a date on the calendar (or navigate to a date directly) to reach the booking form.</p>

        <h6 class="fw-semibold mt-3">Reservation Rules</h6>
        <div class="table-responsive">
          <table class="table table-sm table-bordered small">
            <thead class="table-light">
              <tr><th>Rule</th><th>Details</th></tr>
            </thead>
            <tbody>
              <tr><td>Minimum duration</td><td>2 hours</td></tr>
              <tr><td>Maximum duration</td><td>6 hours</td></tr>
              <tr><td>Time increments</td><td>30-minute intervals (e.g. 9:00, 9:30, 10:00)</td></tr>
              <tr><td>Booking window</td><td>Up to 60 days in advance</td></tr>
              <tr><td>Consecutive days</td><td>Maximum 3 days in a row (default; may vary per member)</td></tr>
              <tr><td>Pending reservations</td><td>Maximum 7 upcoming reservations at once (default)</td></tr>
              <tr><td>Overlap</td><td>Only one reservation per day — cannot overlap existing bookings or blackout dates</td></tr>
            </tbody>
          </table>
        </div>

        <h6 class="fw-semibold mt-3">Reservation Notes</h6>
        <p>You can add an optional note (up to 300 characters) — for example "fishing trip" or "family outing." Notes are visible to other members on the booking page.</p>

        <h6 class="fw-semibold mt-3">Confirmation Email</h6>
        <p>Once your reservation is confirmed you'll receive an email with the date, time, and a link to the Captain's Checklist so you can review it before your trip.</p>

        <h6 class="fw-semibold mt-3">Approval Workflow</h6>
        <p class="mb-0">Depending on club settings, reservations may require administrator approval. If so, your reservation shows <span class="badge bg-warning text-dark">Pending</span> until approved. You'll be notified by email when a decision is made.</p>
      </div>
    </div>

    {# --- My Trips --- #}
    <div class="card border-0 shadow-sm mb-4" id="my-trips">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-bookmark-star me-2 text-club-blue"></i>My Trips
      </div>
      <div class="card-body p-4">
        <p>The <strong>My Trips</strong> page shows all your upcoming and past reservations in one place.</p>

        <h6 class="fw-semibold mt-3">Pre-Trip Reminder Banner</h6>
        <p>When you have a reservation <strong>today or tomorrow</strong>, a yellow reminder banner appears at the top of My Trips with a direct link to the Captain's Checklist and your Check-Out button. You'll also receive an automated reminder email the evening before your trip.</p>

        <h6 class="fw-semibold mt-3">Upcoming Reservations</h6>
        <p>Each upcoming trip shows the date, time, duration, and any notes. On the day of your reservation, two additional actions appear:</p>
        <ul>
          <li><strong>Check Out</strong> <span class="badge bg-club-blue">navy</span> — Complete the departure checklist and record engine hours before leaving the dock.</li>
          <li><strong>Check In</strong> <span class="badge bg-success">green</span> — Record your return details and any fuel added when you get back.</li>
        </ul>

        <h6 class="fw-semibold mt-3">Cancelling a Reservation</h6>
        <p>Click the <strong>Cancel</strong> button next to any upcoming reservation. Members on the waitlist for that date will be automatically notified by email that a slot has opened.</p>

        <h6 class="fw-semibold mt-3">Past &amp; Cancelled Reservations</h6>
        <p class="mb-0">Past trips appear below the upcoming section. From here you can log fuel or report an incident using the icons on the right of each entry.</p>
      </div>
    </div>

    {# --- Check-Out --- #}
    <div class="card border-0 shadow-sm mb-4" id="checkout">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-box-arrow-right me-2 text-club-blue"></i>Check-Out (Departure)
      </div>
      <div class="card-body p-4">
        <p>Check-out is available on the <strong>day of your reservation</strong> from My Trips. It records the boat's condition and your completion of the safety checklist before you leave.</p>

        <h6 class="fw-semibold mt-3">Captain's Checklist</h6>
        <p>An 8-step safety checklist grouped into categories (Pre-Launch, Starting &amp; Departure, Return &amp; Shutdown) must be completed at departure. Check each item that applies and submit when ready. The number of verified items is saved to your trip log.</p>

        <h6 class="fw-semibold mt-3">Departure Details</h6>
        <ul class="mb-0">
          <li><strong>Departure Time</strong> — Pre-filled with the current time; adjust if needed.</li>
          <li><strong>Engine Hours (out)</strong> — Read the engine hour meter and record it here. Helps track maintenance intervals.</li>
          <li><strong>Fuel Level</strong> — Select the current level: Empty, ¼, ½, ¾, or Full.</li>
          <li><strong>Condition Notes</strong> — Note any pre-existing damage before leaving. This protects you if something was already damaged.</li>
        </ul>
      </div>
    </div>

    {# --- Check-In --- #}
    <div class="card border-0 shadow-sm mb-4" id="checkin">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-box-arrow-in-left me-2 text-success"></i>Check-In (Return)
      </div>
      <div class="card-body p-4">
        <p>After returning the boat to the dock, use <strong>Check In</strong> from My Trips to close out your trip log.</p>

        <h6 class="fw-semibold mt-3">Return Details</h6>
        <ul>
          <li><strong>Return Time</strong> — When you returned the boat to the dock.</li>
          <li><strong>Engine Hours (in)</strong> — Record the meter on return; the system calculates hours used.</li>
          <li><strong>Fuel Added</strong> — Enter gallons added and total cost. A fuel log entry is created automatically.</li>
          <li><strong>Condition on Return</strong> — Note any issues discovered during your trip. Submit a separate <a href="{{ url_for('new_incident') }}">incident report</a> for significant damage.</li>
        </ul>

        <div class="alert alert-info small mb-0">
          <i class="bi bi-info-circle me-1"></i>
          Always log fuel at check-in — it helps the club track costs and ensures the next boater knows the fuel level.
        </div>
      </div>
    </div>

    {# --- Captain's Checklist --- #}
    <div class="card border-0 shadow-sm mb-4" id="captains-checklist">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-clipboard2-check me-2 text-club-blue"></i>Captain's Checklist
      </div>
      <div class="card-body p-4">
        <p>The <a href="{{ url_for('checklist_page') }}"><strong>Captain's Checklist</strong></a> is an 8-step pre-departure safety guide covering boat startup, safety equipment, and departure procedure.</p>

        <h6 class="fw-semibold mt-3">Using the Standalone Checklist</h6>
        <p>Visit <strong>Rules → Captain's Checklist</strong> at any time to review the steps interactively. You can check items off, track your progress with the progress bar, reset it, and print a copy to bring on the water.</p>

        <h6 class="fw-semibold mt-3">Recorded Checklist at Check-Out</h6>
        <p>The same checklist appears during the <strong>Check-Out</strong> flow on the day of your reservation. Items checked here are <strong>saved to your trip log</strong> so the club has a record of your pre-departure verification.</p>

        <h6 class="fw-semibold mt-3">Club Rules</h6>
        <p class="mb-0">The <a href="{{ url_for('rules_page') }}"><strong>Rules</strong></a> page lists all Boat Club Member Rules alongside the checklist. Review these before your first trip.</p>
      </div>
    </div>

    {# --- Weather Alerts --- #}
    <div class="card border-0 shadow-sm mb-4" id="weather-alerts">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-cloud-lightning-rain me-2 text-club-blue"></i>Weather Alerts &amp; Pre-Trip Reminders
      </div>
      <div class="card-body p-4">
        <p>The system automatically monitors weather conditions and sends proactive notifications to keep you safe on the water.</p>

        <h6 class="fw-semibold mt-3">Evening Reminder (6 PM the night before)</h6>
        <p>If you have a reservation tomorrow, you'll receive an email reminder at 6 PM the evening before with your reservation details and a link to the Captain's Checklist.</p>

        <h6 class="fw-semibold mt-3">Weather Alerts (6 AM daily)</h6>
        <p>Each morning the system checks the <strong>National Weather Service</strong> for active hazardous alerts in the Canyon Lake / Comal County area. If a hazardous alert is active, all members with reservations in the next 48 hours are notified by email. Alert types that trigger notifications include:</p>
        <ul class="mb-2">
          <li>Tornado Warning / Watch</li>
          <li>Severe Thunderstorm Warning / Watch</li>
          <li>Flash Flood or Flood Warning / Watch</li>
          <li>High Wind Warning / Watch or Wind Advisory</li>
          <li>Small Craft Advisory</li>
          <li>Excessive Heat Warning / Watch or Heat Advisory</li>
          <li>Dense Fog Advisory</li>
        </ul>
        <div class="alert alert-warning small mb-0">
          <i class="bi bi-exclamation-triangle me-1"></i>
          Weather alerts are informational. <strong>You are responsible</strong> for making your own go/no-go decision. Always check the full NWS forecast before heading out.
        </div>
      </div>
    </div>

    {# --- Waitlist --- #}
    <div class="card border-0 shadow-sm mb-4" id="waitlist">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-hourglass-split me-2 text-club-blue"></i>Waitlist
      </div>
      <div class="card-body p-4">
        <p>If the boat is already reserved on a date you want, you can join the <strong>waitlist</strong> for that day.</p>

        <h6 class="fw-semibold mt-3">How It Works</h6>
        <ol>
          <li>Navigate to the date on the calendar — you'll see a <strong>Join Waitlist</strong> button since the day is already taken.</li>
          <li>Click it. You're now in the queue.</li>
          <li>If the existing reservation is <strong>cancelled</strong>, you'll receive an email notification automatically.</li>
          <li>Click the link in the email (or navigate to the calendar) and book before someone else does.</li>
        </ol>

        <h6 class="fw-semibold mt-3">Managing Your Waitlist</h6>
        <p class="mb-0">Active waitlist entries appear at the bottom of <strong>My Trips</strong>. Use the <strong>Leave</strong> button to remove yourself if your plans change. A <span class="badge bg-success">Notified</span> badge means a slot became available and you were emailed.</p>
      </div>
    </div>

    {# --- Messages --- #}
    <div class="card border-0 shadow-sm mb-4" id="messages">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-chat-square-text me-2 text-club-blue"></i>Message Board
      </div>
      <div class="card-body p-4">
        <p>The <strong>Message Board</strong> is the club's communication hub for announcements, trip reports, tips, and general conversation.</p>

        <h6 class="fw-semibold mt-3">Reading Messages</h6>
        <p><span class="badge bg-warning text-dark"><i class="bi bi-megaphone me-1"></i>Announcement</span> posts (created by admins) are highlighted with a gold border — read these promptly.</p>

        <h6 class="fw-semibold mt-3">Posting a Message</h6>
        <p>Click <strong>Post Message</strong> and fill in a title and body. You can attach up to <strong>5 photos</strong> per post (images only).</p>

        <h6 class="fw-semibold mt-3">Deleting Messages</h6>
        <p class="mb-0">You can delete your own messages using the trash icon. Admins can delete any message.</p>
      </div>
    </div>

    {# --- Profile --- #}
    <div class="card border-0 shadow-sm mb-4" id="profile">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-person-gear me-2 text-club-blue"></i>Your Profile
      </div>
      <div class="card-body p-4">
        <p>Access your profile from the <strong>user menu</strong> in the top-right navbar corner. Here you can update your photo, contact info, member name, and security settings.</p>

        <h6 class="fw-semibold mt-3">Profile Photo</h6>
        <p>Upload a photo (max 5 MB, any image format). Your photo appears as your avatar on reservations. If you don't upload one, your first initial is shown.</p>

        <h6 class="fw-semibold mt-3">Member Name</h6>
        <p>This is the name shown on the <strong>calendar and reservations</strong> — visible to all members. It defaults to <em>The [Last Name] family</em> (e.g. "The Hasting family"). You can change it to anything you like — your name, a nickname, or your family name.</p>

        <h6 class="fw-semibold mt-3">Phone Number</h6>
        <p>Add your phone number so other members and admins can reach you.</p>

        <h6 class="fw-semibold mt-3">Changing Your Email</h6>
        <p>Enter a new email and click <strong>Send Verification</strong>. A verification link is emailed to the new address. <strong>Your current email stays active</strong> until you click the link. Check spam if you don't see it.</p>

        <h6 class="fw-semibold mt-3">Changing Your Password</h6>
        <p class="mb-0">Enter your current password and a new one (minimum 8 characters). Confirm the new password before saving.</p>
      </div>
    </div>

    {# --- Family Login --- #}
    <div class="card border-0 shadow-sm mb-4" id="family-login">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-person-plus me-2 text-club-blue"></i>Family Login
      </div>
      <div class="card-body p-4">
        <p>The <strong>Family Login</strong> section (in your Profile) lets you set up a second email and password so another household member — a spouse or partner — can log in to the <strong>same account</strong>.</p>

        <h6 class="fw-semibold mt-3">How It Works</h6>
        <ul>
          <li>The primary account holder sets a <strong>family email</strong> and <strong>family password</strong> in their Profile.</li>
          <li>The family member logs in using that email and password at the normal login page.</li>
          <li>They have full access to the shared account — they can book, view, and cancel reservations just like the primary member.</li>
          <li>Reservations appear under the shared <strong>member name</strong> (e.g. "The Hasting family") regardless of who booked them.</li>
        </ul>

        <h6 class="fw-semibold mt-3">One Slot, Two Logins</h6>
        <p>Family accounts share one reservation slot per day. If Sharon books the boat, Richard cannot also book the same day — they are the same account.</p>

        <h6 class="fw-semibold mt-3">Removing the Family Login</h6>
        <p class="mb-0">The primary account holder can click <strong>Remove</strong> in the Family Login section of their profile at any time to revoke the second set of credentials.</p>
      </div>
    </div>

    {# --- Fuel Log --- #}
    <div class="card border-0 shadow-sm mb-4" id="fuel-log">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-fuel-pump me-2 text-club-blue"></i>Fuel Log
      </div>
      <div class="card-body p-4">
        <p>Fuel usage is tracked to help the club manage costs and ensure the boat always has adequate fuel.</p>

        <h6 class="fw-semibold mt-3">Logging Fuel at Check-In</h6>
        <p>The easiest way is during <strong>check-in</strong> — enter gallons added and total cost. A fuel log entry is created automatically.</p>

        <h6 class="fw-semibold mt-3">Manual Fuel Entry</h6>
        <p class="mb-0">You can also log fuel separately from <strong>My Trips</strong> by clicking the <i class="bi bi-fuel-pump"></i> icon on a past trip. Fill in the date, gallons, price per gallon, and total cost.</p>
      </div>
    </div>

    {# --- Incidents --- #}
    <div class="card border-0 shadow-sm mb-4" id="incidents">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-exclamation-triangle me-2 text-warning"></i>Incident Reports
      </div>
      <div class="card-body p-4">
        <p>If you observe or cause damage to the boat, you must submit an <strong>incident report</strong>. Prompt reporting helps the club respond quickly and keeps the boat safe for everyone.</p>

        <h6 class="fw-semibold mt-3">Severity Levels</h6>
        <div class="table-responsive">
          <table class="table table-sm table-bordered small">
            <thead class="table-light">
              <tr><th>Severity</th><th>Description</th><th>Examples</th></tr>
            </thead>
            <tbody>
              <tr>
                <td><span class="badge bg-info text-dark">Minor</span></td>
                <td>Cosmetic or minor issue</td>
                <td>Scratch, small dent, missing cup holder</td>
              </tr>
              <tr>
                <td><span class="badge bg-warning text-dark">Moderate</span></td>
                <td>Affects boat operation</td>
                <td>Broken bilge pump, engine warning light</td>
              </tr>
              <tr>
                <td><span class="badge bg-danger">Major</span></td>
                <td>Significant damage or safety concern</td>
                <td>Hull damage, engine failure, navigation equipment</td>
              </tr>
            </tbody>
          </table>
        </div>

        <h6 class="fw-semibold mt-3">Submitting a Report</h6>
        <p class="mb-0">Go to <strong>My Trips</strong> and click the <i class="bi bi-exclamation-triangle text-warning"></i> icon on a past trip, or go to <a href="{{ url_for('new_incident') }}">Report Incident</a> directly. Include as much detail as possible.</p>
      </div>
    </div>

    {# --- Feedback --- #}
    <div class="card border-0 shadow-sm mb-4" id="feedback">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-chat-left-text me-2 text-club-blue"></i>Submitting Feedback
      </div>
      <div class="card-body p-4">
        <p>The <strong>Feedback</strong> button (found in the footer or site menu) lets you send suggestions, bug reports, or general comments to the club administrators.</p>

        <h6 class="fw-semibold mt-3">How Feedback is Routed</h6>
        <p>Feedback is automatically triaged by AI:</p>
        <ul>
          <li><strong>Bug reports and feature requests</strong> → automatically filed as a GitHub issue for the development team.</li>
          <li><strong>Comments, praise, questions, or club policy concerns</strong> → sent directly to the club administrator by email.</li>
        </ul>

        <h6 class="fw-semibold mt-3">Attachments</h6>
        <p class="mb-0">You can attach any file (image, PDF, document, etc.) up to <strong>10 MB</strong> to your feedback. Screenshots are especially useful for bug reports. Attachments are saved and accessible to admins for review.</p>
      </div>
    </div>

    {# --- iCal --- #}
    <div class="card border-0 shadow-sm mb-4" id="ical">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-calendar-plus me-2 text-club-blue"></i>Calendar Subscription (iCal)
      </div>
      <div class="card-body p-4">
        <p>Subscribe to your reservations in any calendar app that supports iCal (Google Calendar, Apple Calendar, Outlook, etc.).</p>

        <h6 class="fw-semibold mt-3">How to Subscribe</h6>
        <ol>
          <li>Go to <strong>My Trips</strong> and click the <i class="bi bi-calendar-plus"></i> icon in the top-right corner.</li>
          <li>Copy your personal iCal feed URL.</li>
          <li>In your calendar app, choose <strong>Subscribe to calendar</strong> (or "Add calendar by URL") and paste the URL.</li>
          <li>Your upcoming boat reservations will appear and stay in sync automatically.</li>
        </ol>

        <div class="alert alert-secondary small mb-0">
          <i class="bi bi-shield-lock me-1"></i>
          Your iCal URL contains a unique personal token — do not share it with others.
        </div>
      </div>
    </div>

    {# ================================================================
       ADMIN GUIDE
       ================================================================ #}
    {% if current_user.is_admin %}
    <h5 class="text-uppercase text-muted fw-semibold small mb-3 mt-5" id="admin-guide">
      <i class="bi bi-shield-check me-1"></i>Admin Guide
    </h5>

    {# --- Members --- #}
    <div class="card border-0 shadow-sm mb-4" id="admin-members">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-people me-2 text-club-blue"></i>Managing Members
      </div>
      <div class="card-body p-4">
        <p>Access member management from <strong>Admin → Members</strong>.</p>

        <h6 class="fw-semibold mt-3">Creating a New Member</h6>
        <p>Click <strong>Add Member</strong> and fill in their full name, username, and email. Leave the password blank to send them a <strong>welcome email</strong> with a link to set their own password (expires in 72 hours). Or set a temporary password manually if they have no email.</p>

        <h6 class="fw-semibold mt-3">Per-Member Limits</h6>
        <ul>
          <li><strong>Max Consecutive Days</strong> — Days in a row they can reserve (default: 3)</li>
          <li><strong>Max Pending Reservations</strong> — Upcoming reservations at once (default: 7)</li>
        </ul>

        <h6 class="fw-semibold mt-3">Deactivating a Member</h6>
        <p>Click the <i class="bi bi-person-x"></i> icon. Deactivated accounts cannot log in. Existing reservations are not cancelled automatically.</p>

        <h6 class="fw-semibold mt-3">Resetting a Password</h6>
        <p class="mb-0">Click the <i class="bi bi-key"></i> icon next to a member to set a new temporary password, or use the <strong>forgot password</strong> flow to send them a reset link.</p>
      </div>
    </div>

    {# --- Family Accounts --- #}
    <div class="card border-0 shadow-sm mb-4" id="admin-family">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-people-fill me-2 text-club-blue"></i>Family Accounts
      </div>
      <div class="card-body p-4">
        <p>Click the <i class="bi bi-person-gear"></i> icon on any member to open the <strong>Edit Profile</strong> page. Here you can configure two things:</p>

        <h6 class="fw-semibold mt-3">Display Name (Member Name)</h6>
        <p>This overrides what's shown on the calendar and reservation lists. Defaults to "The [Last Name] family" when a member is created. Editable by both admins and the member themselves from their profile.</p>

        <h6 class="fw-semibold mt-3">Family Account (Primary Member)</h6>
        <p>If you want to link two logins to one shared account, the preferred approach is for the <strong>primary member</strong> to set up a family email + password in their Profile. This is self-service and doesn't require admin action.</p>
        <p class="mb-0">Alternatively, you can use the admin edit page to set a member's <strong>Family Account</strong> field — pointing them at a primary account. All their reservation activity will be attributed to and shared with the primary account. Use this for accounts that need to be explicitly linked rather than just sharing credentials.</p>
      </div>
    </div>

    {# --- Blackouts --- #}
    <div class="card border-0 shadow-sm mb-4" id="admin-blackouts">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-calendar-x me-2 text-club-blue"></i>Blackout Dates
      </div>
      <div class="card-body p-4">
        <p>Blackout dates prevent reservations during maintenance, club events, or other unavailability periods.</p>

        <h6 class="fw-semibold mt-3">Creating a Blackout</h6>
        <p class="mb-0">Go to <strong>Admin → Blackout Dates → New Blackout</strong>. Specify a start/end date and time and a reason. The reason is displayed on the calendar so members know why the date is blocked.</p>
      </div>
    </div>

    {# --- Approvals --- #}
    <div class="card border-0 shadow-sm mb-4" id="admin-approvals">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-hourglass-split me-2 text-club-blue"></i>Reservation Approvals
      </div>
      <div class="card-body p-4">
        <p>If <strong>approval required</strong> mode is enabled, new reservations start as <span class="badge bg-warning text-dark">Pending</span> and must be approved by an admin. Go to <strong>Admin → Approvals</strong> and click <strong>Approve</strong> or <strong>Deny</strong> for each pending request. The member is notified by email either way.</p>
        <p class="mb-0">When approval mode is <em>off</em>, reservations are confirmed immediately.</p>
      </div>
    </div>

    {# --- Admin Incidents --- #}
    <div class="card border-0 shadow-sm mb-4" id="admin-incidents">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-exclamation-triangle me-2 text-club-blue"></i>Incidents
      </div>
      <div class="card-body p-4">
        <p>View all damage and incident reports at <strong>Admin → Incidents</strong>. Once an issue has been addressed, click <strong>Resolve</strong> — the system records your name and timestamp. Resolved incidents remain visible for the record.</p>
      </div>
    </div>

    {# --- Fuel Stats --- #}
    <div class="card border-0 shadow-sm mb-4" id="admin-fuel">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-fuel-pump me-2 text-club-blue"></i>Fuel Statistics
      </div>
      <div class="card-body p-4">
        <p><strong>Admin → Fuel Log</strong> shows per-member fuel totals (gallons and cost), individual entries with date and linked reservation, and club-wide totals. Entries come from trip check-in or manual entry by members.</p>
      </div>
    </div>

    {# --- Trip Logs --- #}
    <div class="card border-0 shadow-sm mb-4" id="admin-trip-logs">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-journal-bookmark me-2 text-club-blue"></i>Trip Logs
      </div>
      <div class="card-body p-4">
        <p><strong>Admin → Trip Logs</strong> shows a complete history of all check-out and check-in records. Each entry includes:</p>
        <ul class="mb-0">
          <li>Member name and reservation date/time</li>
          <li>Departure time and engine hours out / in (hours used)</li>
          <li>Fuel level at departure</li>
          <li>Fuel added (gallons and cost)</li>
          <li>Condition notes on departure and return</li>
          <li>Number of captain's checklist items verified</li>
        </ul>
      </div>
    </div>

    {# --- Feedback --- #}
    <div class="card border-0 shadow-sm mb-4" id="admin-feedback">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-chat-left-text me-2 text-club-blue"></i>Feedback
      </div>
      <div class="card-body p-4">
        <p><strong>Admin → Feedback</strong> shows all member feedback submissions in reverse chronological order.</p>

        <h6 class="fw-semibold mt-3">What You'll See</h6>
        <ul>
          <li>Member name, submission date, and full feedback text</li>
          <li>Routing badge — <span class="badge bg-primary">GitHub Issue</span> or <span class="badge bg-success">Email</span></li>
          <li>Attachments — images shown as inline thumbnails, other files as download links</li>
          <li>A link to the GitHub issue if one was created</li>
        </ul>
        <p class="mb-0">Feedback is automatically routed by AI: bug reports and feature requests go to GitHub; everything else is emailed to the feedback address configured in <code>.env</code>.</p>
      </div>
    </div>

    {# --- Audit Log --- #}
    <div class="card border-0 shadow-sm mb-4" id="admin-audit">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-journal-text me-2 text-club-blue"></i>Audit Log
      </div>
      <div class="card-body p-4">
        <p>The <strong>Admin → Audit Log</strong> is an immutable record of every significant action in the system.</p>

        <h6 class="fw-semibold mt-3">What's Tracked</h6>
        <ul>
          <li>Reservations created, cancelled, approved, and denied</li>
          <li>User accounts created, deactivated, and profile updates</li>
          <li>Password changes and resets</li>
          <li>Incident reports submitted and resolved</li>
          <li>Trip check-out and check-in events</li>
          <li>Feedback submissions</li>
        </ul>

        <h6 class="fw-semibold mt-3">Filtering</h6>
        <p class="mb-0">By default the log shows the last 30 days. Use the <strong>Days back</strong> selector for a longer history. Each entry shows the timestamp, user, action type, and details.</p>
      </div>
    </div>

    {# --- Export CSV --- #}
    <div class="card border-0 shadow-sm mb-4" id="admin-export">
      <div class="card-header bg-transparent fw-semibold">
        <i class="bi bi-download me-2 text-club-blue"></i>Export CSV
      </div>
      <div class="card-body p-4">
        <p>Click <strong>Admin → Export CSV</strong> to download a spreadsheet of member reservation statistics — past trips, upcoming trips, total reservations, and cancellations per member.</p>
      </div>
    </div>
    {% endif %}

    <div class="text-center text-muted small mt-4 mb-3">
      <i class="bi bi-anchor me-1"></i>FleetNests &mdash; Reservation System Help
    </div>

  </div>
</div>
{% endblock %}
